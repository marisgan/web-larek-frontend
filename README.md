# Проектная работа "Веб-ларек"

Web-ларёк - это интернет-магазин с товарами для веб-разработчиков. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

Стек: HTML, SCSS, JavaScript, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс IItem для объекта единицы товара, который используется в приложении.

```
interface IItem {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
  }
```

Интерфейс ICatalogModel - главный источник данных, хранит всю информацию о товарах

```
interface ICatalogModel {
    setItems(items: IItem[]): void;
    getItems(): IItem[];
    getItem(id: string): IItem;
    setPreview(id: string): void;
    getPreview(id: string): IItem;
    getTotal(itemsIds: string[]): number;
}
```

Интерфейс IBasketModel для модели корзины товаров

```
interface IBasketModel {
      addItem(id: string): void;
      removeItem(id: string): void;
      getItems(): string[];
      getCount(): number;
      contains(id: string): boolean;
      clearBasket(): void;
  }
```
Интерфейс IUserInfo для хранения и валидации данных пользователя
```
interface IUserInfo {
    payment: string;
    address: string;
    email: string;
    phone: string;
}
```

## Архитектура приложения

Архитектура спроектирована согласно парадигме MVP (Models - Views - Presenter), опираясь на событийно-ориентированный подход. Код приложения разделен на слои:

- слой данных - отвечает за хранение и изменение данных
- слой представления - отвечает за отображение данных на странице
- презентер - отвечает за взаимодействие компонентов представления и моделей данных

### Базовый код

#### Класс Api

Базовый класс реализует логику работы с сервером. В конструктор передается базовый адрес сервера и опциональный объект с настройками запросов.

Методы:
- `get` - выполняет GET-запрос на переданный в параметрах ендпоинт и возвращает промис с объектом ответа сервера.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST-запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий - позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные метоы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Component
Абстрактный базовый класс компонент - основной родитель для всех элементов представления. Его задача отображать на странице те данные, которые мы в него передаем. Является дженериком и требует тип данных, который будет передаваться в класс и заставлять его перерисовывать элемент с помощью метода render.\
Принимает в конструкторе HTML-элемент и сохраняет его в защищенном поле контейнер. Метод рендер принимает объект с partial данными, которые нужно отобразить в требуемом контейнере, заполняет контейнер через Object.assign и сеттеры и возвращает обновленный контейнер компонента.


### Слой данных

#### Класс CatalogModel
Класс отвечает за хранение и логику работы с данными товаров.
Имплементирует интерфейс ICatalogModel.\
Конструктор класса принимает инстанс брокера событий.\
В полях класса хранятся следующие данные:
- items: Map<string, IItem> - объект Map, который хранит ключ - id товара, значение - объект товара
- preview: id - id товара, выбранного для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` вызывает события при изменении данных.

Также класс предоставляет набор методов для взаимодействия с данными:
- setItems(items: IItem[]): void - сохраняет массив товаров
- getItems(): IItem[] - получить массив товаров
- setPreview(id: string): void - сохранить выбранный товар для открытия в модальном окне
- getPreview(): IItem - возвращает объект товара, выбранного для просмотра в модальном окне
- getTotal(itemsIds: string[]): number - принимает список id товаров и возвращает общую сумму

#### Класс BasketModel
Класс отвечает за хранение списка вабранных товаров и логику работы с корзиной товаров. Имплементирует интерфейс IBasketModel.
Конструктор класса принимает инстанс брокера событий.\
В полях класса хранятся следующие данные:
- items: Set\<string> - сет из id товаров, положенных в корзину
- events: IEvents - экземпляр класса `EventEmitter` вызывает события при изменении данных.
Методы класса:
- addItem(id: string): void - добавить товар в корзину
- deleteItem(id: string): void - удалить товар из корзины
- getItems(): string[] - получить список id добавленных товаров
- getCount(): number - получить число товаров в корзине
- contains(id: string): boolean - узнать, добавлен ли товар в корзину
- clearBasket() - очистить сет с добавленными товарами

#### Класс UserModel
для хранения и валидации информации о покупателе.
Поля:
- userInfo: IUserInfo - объект с полями способа оплаты, адреса, email, телефон - для удобной валидации и сохранения данных
Методы:
- getUserInfo(): IUserInfo - возвращает данные пользователя
- setUserInfo(data: Partial<IUserInfo>): void - устанавливает данные пользователя
- validateAndEmit(user: IUserInfo): void - валидирует поля и инициирует события для управления формой и показом ошибок валидации. Вызывается только внутри модели при установке данных.
- clearUserInfo(): void - очищает объект с данными пользователя


### Слой представления
Все классы представления наследуются от базового родительского класса Component. Управляют разметкой элементов внутри контейнера (DOM-элемента) передаваемых в них данных.

#### Класс Header
Отвечает за отображение счетчика товаров в шапке сайта и за кнопку открытия корзины. Дженерик принимает тип данных `IHeader` - объект с таким интерфейсом будет передаваться в метод рендер.
В конструкторе выбираются элементы разметки с помощью функции-утилиты ensureElement и сохраняются в поля. Устанавливается слушатель на кнопку открытия корзины, который при нажатии генерирует событие.
Поля:
- openBasket: HTMLButtonElement
- counterElement: HTMLElement
Сеттер для счетчика:
- set counter(value: number): void;

#### Класс CatalogView
Отвечает за отображение каталога карточек товаров на главной странице. Принимает массив карточек товара (ICatalogView) и вставляет их в разметку.

Поля:
- container: HTMLElement

Сеттер для каталога:
- set cardsList(cards: HTMLElement[])

#### Класс Modal
Реализует универсальное модальное окно. Предоставляет методы `open` и `close` для управление отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

У него есть блок контент, в который будут размещаться HTML-элементы из шаблонов разных типов модальных окон.

Поля класса:

- contentElement: HTMLElement;
- closeButton: HTMLButtonElement;

Сеттер для контента:
- set content(element: HTMLElement)

#### Класс Form

Реализует универсальный объект формы, при создании принимает элемент формы и брокер событий. В конструкторе устанавливаются слушатели на ввод, нажатие кнопок и сабмит формы.

Поля:
- container: HTMLElement
- events: IEvents
- submitButton: HTMLButtonElement;
- errorElement: HTMLElement;
- inputs: HTMLInputElement[];
- altButtons: HTMLButtonElement[] | null = null;

Методы:
- set submitState(state: boolean) - устанавливает активность кнопки сабмита
- set error(value: string) - устанваливает текст ошибки
- clearForm - очищает данные инпутов и опций после сабмита
- render - возвращает готовый контейнер с формой
- сеттеры для установки данных из модели пользователя в инпуты

#### Класс Card

Отвечает за отображение карточки, задавая в карточке данные: название, изображение, цена, описание, категория. В конструктор класса предается DOM-элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. Карточка может выводиться на главной странице, как содержимое модального окна - попап с подробной информации или как строка в корзине. В классе устанавливаются слушатели на интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события. В полях класса находятся элементы разметки карточки и хранится id товара, который отображает данная карточка.

Методы:
- render - заполняет атрибуты элементов карточки данными и возвращает разметку с помощью сеттеров
- сеттеры атрибутов карточки
- геттер id возвращает уникальный id карточки, который сохраняется в полях класса, чтобы можно было выполнять дополнительные функции, например, при генерации события передавать id карточки, в котором возникло событие.

#### Класс Success

Отвечает за показ финального сообщения после успешного оформления заказа. При создании принимает элемент контейнера и брокер событий. В конструкторе устанавливается слушатель на кнопку перехода к дальнейшим покупкам.
Поля:
- totalElement - элемент разметки для вывода суммы покупки
- closeButton - элемент разметки для кнопки перехода в каталог и закрытия модального окна

Методы:
set total - сеттер для вывода суммы заказа



### Слой коммуникации
Отвечает за коммуникацию приложения с бекендом сервера.

#### Класс WebLarekApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом.

## Презентер: взаимодействие компонентов и моделей
Роль презентера выполняет блок кода, размещенный в основном скрипте приложения в файле `index.ts`. Взаимодействие представления и данных между собой осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список событий, которые могут генерироваться в системе на основе пользовательских сценариев:*

*События связанные с изменением данных(генерируются классами моделей данных)*

- `catalog:changed` - изменение массива товаров в каталоге
- `preview:changed` - изменение открываемой в модальном окне карточки
- `basket:changed` - изменение массива товаров в корзине
- `customer:changed` - изменение данных покупателя
- `errors:changed` - изменение в ошибках валидации
- `order:ready` - заполнение всех полей оформления заказа
- `contacts:ready` - заполнение всех полей формы контактов
- `order:error` - ошибка в форме заказа
- `contacts:error` - ошибка в форме контактов

*События, которые возникают при взаимодействии пользователя с интерфейсом(генерируются классами представления)*
- `card:selected` - пользователь нажала на карточку в каталоге
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `item:buy` - пользователть добавляет товара в козину
- `item:remove` - пользователь удаляет товар из корзины
- `basket:open` - открытие корзины
- `order:start` - открытие окна с формой сбора данных оплаты и доставки
- `payment:input` - заполнение метода оплаты
- `order:input` - заполнение формы заказа
- `contacts:input` - заполнение формы контактов
- `order:submit` - сабмит формы заказа
- `contacts:submit` - сабмит формы контактов
- `success:close` - закрытие финального окна