# Проектная работа "Веб-ларек"

Web-ларёк - это интернет-магазин с товарами для веб-разработчиков. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс IItem для учета товаров, которые будут использоваться в приложении.

```
interface IItem {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number | null;
  }
```

Интерфейс ICatalog для хранения массива карточек товаров.

```
interface ICatalog {
    items: IItem[];
    preview: IItem;
    setItems(items: IItem[]): void;
    getItems(): IItem[];
    setItemPreview(item: IItem): void;
    getItemPreview(): IItem;
}
```

Интерфейс ICart для проектирования функционала корзины товаров.

```
interface ICart {
    items: IItem[];
    addItem(item: IItem): void;
    deleteItem(id: TItemId): void;
    getItems(): IItem[];
    getCount(): number;
    getTotal(): number;
    isInCart(id: TItemId): boolean;
    getOrder(): IOrder;
}
```
Интерфейс ICustomer для хранения и валидации данных покупателя
```
export interface ICustomer {
    payment: 'card' | 'cash' | '';
    email: string;
    phone: string;
    address: string;
    validateInfo(data: Record<keyof TCustomerInfo, string>): boolean;
    setInfo(data: Record<keyof TCustomerInfo, string>): void;
    getInfo(): Record<keyof TCustomerInfo, string>;
}
```


Тип TItemId нужен для типизации массива с id товаров
```
type TItemId = Pick<IItem, 'id'>;
```
Интерфейс IOrder для метода составления заказа для отправки на сервер из корзины
```
interface IOrder extends TCustomerInfo {
    total: number;
    items: TItemId[]
}
```


## Архитектура приложения

Архитектура спроектирована согласно парадигме MVP (Models - Views - Presenter), опираясь на событийно-ориентированный подход. Код приложения разделен на слои:

- слой данных - отвечает за хранение и изменение данных
- слой представления - отвечает за отображение данных на странице
- презентер - отвечает за взаимодействие компонентов представления и моделей данных

### Базовый код

#### Класс Api

Базовый класс реализует логику работы с сервером. В конструктор передается базовый адрес сервера и опциональный объект с настройками запросов.

Методы:
- `get` - выполняет GET-запрос на переданный в параметрах ендпоинт и возвращает промис с объектом ответа сервера.
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST-запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий - позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.
Основные метоы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emint` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Component
Абстрактный базовый класс компонент - основной родитель для всех элементов представления. Его задача отображать на странице те данные, которые мы в него передаем. Является дженериком и требует тип данных, который будет передаваться в класс и заставлять его перерисовывать элемент с помощью метода render.\
Принимает в конструкторе HTML-элемент и сохраняет его в защищенном поле контейнер. Метод рендер принимает объект с partial данными, которые нужно отобразить в требуемом контейнере, заполняет контейнер через Object.assign и сеттеры и возвращает обновленный контейнер компонента.


### Слой данных

#### Класс ItemsCatalog
Класс отвечает за хранение и логику работы с данными товаров.
Имплементирует интерфейс ICatalog.\
Конструктор класса принимает инстанс брокера событий.\
В полях класса хранятся следующие данные:
- items: IItem[] - массив объектов товаров
- preview: IItem - объект товара, выбранного для просмотра в модальном окне
- events: IEvents - экземпляр класса `EventEmitter` вызывает события при изменении данных.

Также класс предоставляет набор методов для взаимодействия с данными:
- setItems(items: IItem[]): void - сохраняет массив товаров
- getItems(): IItem[] - получить массив товаров
- setItemPreview(item: IItem): void - сохранить выбранный товар для открытия в модальном окне
- getItemPreview(): IItem - получить товар, выбранный для просмотра в модальном окне

#### Класс ShoppingCart
Класс отвечает за хранение данных и логику работы с корзиной товаров. Имплементирует интерфейс ICart.
Конструктор класса принимает инстанс брокера событий.\
В полях класса хранятся следующие данные:
- items: IItem[] - массив товаров, положенных в корзину
- events: IEvents - экземпляр класса `EventEmitter` вызывает события при изменении данных.
Методы класса:
- addItem(item: IItem): void - добавить товар в корзину
- deleteItem(id: TItemId): void - удалить товар из корзины
- getItems(): IItem[] - получить список добавленных товаров
- getCount(): number - получить число товаров в корзине
- getTotal(): number - получить сумму стоимости добавленных товаров
- isInCart(id: TItemId): boolean - узнать, добавлен ли товар в корзину
- getOrder(): IOrder - сформировать заказ для отправки на сервер

#### Класс Customer
для хранения и валидации информации о покупателе.
Поля:
- payment: 'card' | 'cash' | '' - способ оплаты
- email: string;
- phone: string;
- address: string;
Методы:
- validateInfo(data: Record<keyof TCustomerInfo, string>): boolean;
- setInfo(data: Record<keyof TCustomerInfo, string>): void;
- getInfo(): Record<keyof TCustomerInfo, string>;


### Слой представления
Все классы представления наследуются от базового родительского класса Component. Управляют разметкой элементов внутри контейнера (DOM-элемента) передаваемых в них данных.

#### Класс Header
Отвечает за отображение счетчика товаров в шапке сайта и за кнопку открытия корзины. Дженерик принимает тип данных `IHeaderData` - объект с таким интерфейсом будет передаваться в метод рендер.
В конструкторе выбираются элементы разметки с помощью функции-утилиты ensureElement и сохраняются в поля. Устанавливается слушатель на кнопку открытия корзины, который при нажатии генерирует событие.
Поля:
- cartButton: HTMLButtonElement
- cartCounter: HTMLElement
Сеттер для счетчика:
- set counter(value: number): void;

#### Класс Gallery
Отвечает за отображение каталога карточек товаров на главной странице. Принимает массив карточек товара и вставляет их в разметку. Дженерик компонента принимает тип данных `TGalleryData = {catalog: HTMLElement[]}`
Поля:
- catalogElement: HTMLElement
Сеттер для каталога:
- set catalog(items: HTMLElement[])

#### Класс Modal
Реализует универсальное модальное окно. Предоставляет методы `open` и `close` для управление отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

У него есть блок контент, в который будут размещаться HTML-элементы из шаблонов разных типов модальных окон.
Поля класса:
- modalContent: HTMLElement
- events: IEvents
- closeButton: HTMLButtonElement
Сеттер для контента:
- set content(element: HTMLElement)

#### Класс Form
Реализует универсальный объект формы, при создании принимает элемент формы и брокер событий. В конструкторе устанавливаются слушатели на ввод, нажатие кнопок и сабмит формы.
Поля:
- container: HTMLElement
- events: IEvents
- submitButton: HTMLButtonElement
- errorText: HTMLElement
Методы:
- clearForm
- сеттеры
- render

#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные: название, изображение, цена, описание, категория. В конструктор класса предается DOM-элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. Карточка может выводиться на главной странице, как содержимое модального окна - попап с подробной информации или как строка в корзине. В классе устанавливаются слушатели на интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события. В полях класса находятся элементы разметки карточки и id товара.

Методы:
- render - заполняет атрибуты элементов карточки данными и возвращает разметку с помощью сеттеров
- сеттеры атрибутов карточки
- геттер id возвращает уникальный id карточки, который сохраняется в полях класса, чтобы можно было выполнять дополнительные функции, например, при генерации события передавать id карточки, в котором возникло событие.

### Слой коммуникации
Отвечает за коммуникацию приложения с бекендом сервера.

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом.

## Презентер: взаимодействие компонентов и моделей
Роль презентера выполняет блок кода, размещенный в основном скрипте приложения в файле `index.ts`. Взаимодействие представления и данных между собой осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список событий, которые могут генерироваться в системе на основе пользовательских сценариев:*

*События связанные с изменением данных(генерируются классами моделей данных)*

- `catalog:changed` - изменение массива товаров в каталоге
- `card:selected` - изменение открываемой в модальном окне карточки
- `cart:changed` - изменение массива товаров в корзине

*События, которые возникают при взаимодействии пользователя с интерфейсом(генерируются классами представления)*
- `cart:add` - добавление товара в козину
- `cart:delete` - удаление товара из корзины
- `cart:open` - открытие корзины
- `cart:order` - оформление заказа в козине
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `card:select` - выбор карточки для отображения в модальном окне
- `payment:input` - заполнение метода оплаты
- `address:input` - заполнение адреса доставки
- `payment:submit` - сабмит формы заказа
- `email:input` - заполнение email
- `phone:input` - заполнение номера телефона
- `contacts:submit` - сабмит формы контактов